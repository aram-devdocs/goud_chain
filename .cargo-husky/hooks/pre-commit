#!/bin/sh

# Rust checks
echo "Running Rust formatting..."
cargo fmt

# Re-add any formatted files that were staged
STAGED_RS_FILES=$(git diff --name-only --cached | grep '\.rs$' || true)
if [ -n "$STAGED_RS_FILES" ]; then
    echo "$STAGED_RS_FILES" | xargs git add
fi

echo "Running Clippy..."
cargo clippy -- -D warnings || {
    echo "Error: Clippy found issues."
    exit 1
}

echo "Running Rust tests..."
cargo test || {
    echo "Error: Tests failed."
    exit 1
}

echo "Building Rust project..."
cargo build || {
    echo "Error: Build failed."
    exit 1
}

# Dashboard checks
echo "Running dashboard tests..."
./dashboard/test.sh || {
    echo "Error: Dashboard tests failed."
    exit 1
}

echo "All pre-commit checks passed!"
