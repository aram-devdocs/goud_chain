# Development override for hot reload
# SPACE OPTIMIZATION: Shares target/ and cargo cache across all nodes via bind mounts
# This eliminates 3x duplication (saves ~15GB) while maintaining hot reload functionality
services:
  dashboard:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    command: npm run dev
    volumes:
      - ./dashboard:/app
      - /app/node_modules

  node1:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./src:/app/src
      - ./Cargo.toml:/app/Cargo.toml
      - ./Cargo.lock:/app/Cargo.lock
      - shared_cargo_cache:/usr/local/cargo/registry
      - ./target:/app/target
      - node1_data:/data

  node2:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./src:/app/src
      - ./Cargo.toml:/app/Cargo.toml
      - ./Cargo.lock:/app/Cargo.lock
      - shared_cargo_cache:/usr/local/cargo/registry
      - ./target:/app/target

  node3:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./src:/app/src
      - ./Cargo.toml:/app/Cargo.toml
      - ./Cargo.lock:/app/Cargo.lock
      - shared_cargo_cache:/usr/local/cargo/registry
      - ./target:/app/target
      - node3_data:/data

  jupyter:
    volumes:
      # Override with read-write for development (still git-tracked but editable)
      - ./python/notebooks:/home/jovyan/work/notebooks:rw

volumes:
  shared_cargo_cache:
  node1_data:
  node2_data:
  node3_data:
